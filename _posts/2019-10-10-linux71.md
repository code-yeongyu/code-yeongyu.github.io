---
layout: post
title: 보호모드
date: 2019-10-10 10:26:17 +0900
categories: [computer_science, cpu]
---

# 서론

커널 공부를 하려고 하다보니, 기존에 웹만 공부하면서는 접하지 못했던 많은 정통 CS적인 용어들을 많이 접하게 된다. KernelNewbies에서 스케줄링을 읽다 시스템콜을 실행할때 x86 아키텍쳐에서는 CPU Ring level을 3에서 0으로 설정한다는 말을 듣고 CPU Ring level을 찾아보다 이를 다루는 내용인 보호모드를 찾게 되었다.

# 보호모드가 뭐지?

위키피디아에 따르면, 보호모드(컴퓨터 보호 가상 주소 모드)는 x86 CPU에서 사용하는 운영방식이라고 한다. 다중 작업, 가상 메모리, 페이징등의 기능을 구현하기위해서, 그리고 응용 소프트웨어에서 커널단의 작업을 실행할때에도 도움을 주는 그런녀석이라고 한다.

# 그래서 이게 왜 필요한데?

보호모드는 운영체제가 응용 소프트웨어를 더 효과적으로 제어 할 수 있도록 해주는데, 위에서 언급한 페이징과 같은 기능들이 그 예시가 되겠다.

보호모드에서는 권한시스템을 사용하여 응용 소프트웨어의 데이터 접근이나 권한 기능 실행등의 제어 권한을 시스템 소프트웨어가 조절 할 수 있게 해준다. 

보호모드에서는 0부터 3까지의 권한 레벨이 있으며, 숫자가 작을수록 더 많은 권한을 갖게 된다. 대부분의 경우 운영체제나 장치드라이버와 같은 시스템 소프트웨어, 로우레벨적인 소프트웨어들은 당연하게도 링 0에서 동작한다. 그리고 응용 소프트웨어들은 레벨 3에서 동작한다.



# 구체적으로 뭐 어떤 놈이야?

## Protection ring(보호링)

다음의 사진은 [영문 위키피디아](https://en.wikipedia.org/wiki/Protection_ring)에서 가져왔다.

![Protection_ring](https://en.wikipedia.org/wiki/File:Priv_rings.svg)

이 Protection ring(보호 링)이라는 개념은 오늘날 유닉스의 전신인 멀틱스 운영체제에서 소개되었다고 한다. 국문 위키피디아에서와는 다르게, 영문 위키피디아에서는 더 많은 정보를 제공하고 있는데, 대부분의 general-purpose 시스템들은 두개의 링들만 사용한다고 한다. 여기서는 윈도우7과 윈도우 서버 2008을 예시로 들고 있는데, 커널 모드를 위해 0, 유저모드를 위해 3을 사용한다고 한다. 그 이유는 기존 윈도우 시스템들이 두개의 프로텍션 레벨만을 사용가능한 CPU위에서 돌았기 때문이라고.

## 사담

여담이지만 재미있는 사실은, 멀틱스 시스템이 처음 나왔을땐 링 레벨이 8개였다고 한다.

이러한 링 프로텍션들은 몇몇 시스템에서 프로세서 모드와 함께 사용되기도 한다는것같다. (프로세서 모드에 대해서는 다음 글에서 다루도록 하겠다.)

아무튼 이러한 링 아키텍쳐를 효율적으로 다루기 위해서는 하드웨어와 운영체제 사이의 긴밀한 협조가 요구된다고 한다.

# 그 외의 모드

## Supervisor 모드

하드웨어로 중재되는 플래그로써, 시스템 레벨 소프트웨어에 의해 바뀔수 있다고 한다. 기계어가 레지스터나 여러 지시자 테이블을 수정하려고 할때, 혹은 인터럽트를 비활성화 하려고 할때 이것이 가능할지 불가능할지를 결정해주는 역할을 한다.

Supervisor 모드는 모든 명령어(권한이있는 명령 포함)의 실행을 가능하게 해주는 실행모드라고 할 수 있다. 메모리 관리 하드웨어와 같은것들에게 다른 주소공간의 접근권한을 주는 역할도 한다.

듣다보니 뭔가 떠오르지 않는가? 맞다. x86 보호모드 시스템에서의 그 "프로텍션 레벨 0"이다. 조금 햇갈릴 수 있는데, 보호모드의 레벨 0 == Supervisor모드라고 보면 된다.

모든 아키텍쳐를 아우르는 개념에서의 레벨 0이라고 보면 될듯하다.

보호모드의 필요성에 대해 논하려면, 리얼모드에 대해서도 알아야한다. 80286 시대 이후의 x86 컴퓨터의 운영방식이라고 위키피디아에서는 말하고있는데, 
